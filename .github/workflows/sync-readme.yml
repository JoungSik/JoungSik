name: Sync README to Blog Repository

on:
  push:
    branches:
      - master

jobs:
  sync-readme:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout source repo
        uses: actions/checkout@v3
        with:
          submodules: true
          fetch-depth: 0
      
      # 2. README.md íŒŒì¼ ì½ê¸° ë° ë³€ìˆ˜ ì €ì¥
      - name: Read README content
        id: readme
        run: |
          # README.md ë‚´ìš©ì„ ë³€ìˆ˜ì— ì €ì¥ (ë©€í‹°ë¼ì¸ ì²˜ë¦¬)
          {
            echo 'content<<EOF'
            cat README.md
            echo EOF
          } >> $GITHUB_OUTPUT

      - name: Checkout destination repo
        uses: actions/checkout@v3
        with:
          repository: ${{ github.actor }}/blog
          token: ${{ secrets.TOKEN }}
          path: blog-repo
      
      # 4. íŒŒì¼ ì—…ë°ì´íŠ¸ ë° ì»¤ë°‹
      - name: Update README in blog repository
        run: |
          cd blog-repo
          
          # README ë‚´ìš©ì„ ëŒ€ìƒ íŒŒì¼ì— ë³µì‚¬
          echo "${{ steps.readme.outputs.content }}" > content/README.md
          
          # Git ì„¤ì •
          git config user.name "${{ github.actor }}"
          git config user.email "tjstlr2010@gmail.com"
          
          # ë³€ê²½ì‚¬í•­ ì»¤ë°‹ ë° í‘¸ì‹œ
          git add content/README.md
          git diff-index --quiet HEAD || git commit -m "ğŸ”„ Auto-sync README from ${{ github.actor }}/${{ github.actor }} repository
          
          Updated: $(date '+%Y-%m-%d %H:%M:%S UTC')
          Source: ${{ github.sha }}"
          
          git push

      # 5. ì„±ê³µ/ì‹¤íŒ¨ ì•Œë¦¼ (ì„ íƒì‚¬í•­)
      - name: Notify completion
        if: always()
        run: |
          if [ "${{ job.status }}" == "success" ]; then
            echo "âœ… README ë™ê¸°í™”ê°€ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!"
          else
            echo "âŒ README ë™ê¸°í™” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."
          fi
